<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shop | HECS Sweets & Treats</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header>
  <h1>Shop</h1>
  <p class="small">Products and prices are managed by staff via the admin panel.</p>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="shop.html">Shop</a>
    <a href="/admin/">Staff Login</a>
  </nav>
</header>

<main>
  <div id="products" class="grid"></div>
  <p class="small" id="status"></p>
</main>

<footer>
  © HECS Sweets & Treats – Leeds
</footer>

<script>
  async function loadProducts() {
    const status = document.getElementById("status");

    try {
      const res = await fetch("content/products.json", { cache: "no-store" });
      if (!res.ok) throw new Error("products.json not found");

      const data = await res.json();
      const items = data.items || [];

      const grid = document.getElementById("products");
      grid.innerHTML = "";

      if (!items.length) {
        status.textContent = "No products yet — add some in /admin.";
        return;
      }

      items.sort((a, b) => (b.sort_order || 0) - (a.sort_order || 0));

      items.forEach(p => {
        const inStock = p.in_stock !== false;
        const badge = inStock
          ? `<span class="badge">In stock</span>`
          : `<span class="badge out">Out of stock</span>`;

        const image = p.image
          ? `<img src="${p.image}" alt="${p.name}">`
          : "";

        grid.insertAdjacentHTML("beforeend", `
          <div class="card">
            ${image}
            <h3>${p.name}</h3>
            <div class="price">£${Number(p.price).toFixed(2)}</div>
            <p class="small">${p.description || ""}</p>
            ${badge}
            ${p.order_link ? `<a class="btn" href="${p.order_link}" target="_blank">Order</a>` : ""}
          </div>
        `);
      });

      status.textContent = "";

    } catch (err) {
      status.textContent = "Products will appear here after they are added in /admin.";
    }
  }

  loadProducts();
</script>

</body>
</html>
